<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recommended Courses</title>
    <link rel="stylesheet" type="text/css" href="../static/css/migrant.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- jQuery for AJAX -->
</head>
<body>

    <!-- Navigation Bar -->
    <header>
        <nav class="navi_menu">
            <a href="{{ url_for('auth.login') }}"><strong>Home</strong></a>
            <a href="{{ url_for('migrant.migrantlanding') }}"><strong>Recommended Courses</strong></a>
        </nav>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <section class="form-section">
            <h1>Enter Your Profile to Get Recommended Courses</h1>
            <form id="recommendationForm">
                <fieldset>
                    <label for="industry">Industry:</label>
                    <input type="text" id="industry" name="industry" placeholder="E.g., Engineering, Culinaryskills" required>

                    <label for="key_learnings">Key Learnings:</label>
                    <input type="text" id="key_learnings" name="key_learnings" placeholder="E.g., Information about your course" required>

                    <button type="submit">Submit</button>
                </fieldset>
            </form>

            <!-- Feedback Area -->
            <div id="feedback"></div>
        </section>

        <!-- Recommendations Section -->
        <section class="course-section">
            <h2>Top Recommended Courses</h2>
            <div id="courseResults">
                <p class="no-results">No recommended courses yet. Enter your profile above to see recommendations.</p>
            </div>
        </section>
    </div>
<!-- JavaScript for Form Submission -->
<script>
    $(document).ready(function() {
        $('#recommendationForm').on('submit', function(event) {
            event.preventDefault();

            $('#feedback').text('');
            $('#courseResults').html('');

            var formData = {
                'industry': $('#industry').val(),
                'key_learnings': $('#key_learnings').val(),
            };

            $.ajax({
                type: 'POST',
                url: "{{ url_for('migrant.recommendcourse') }}",
                data: formData,
                success: function(response) {
                    var courseResults = $('#courseResults');
                    courseResults.empty();

                    if (response.courses.length > 0) {
                        $.each(response.courses, function(index, course) {
                            if (course.Similarity_Score > 20) {
                                var card = `
                                    <div class="course-card">
                                        <div class="course-title">${course.CourseName}</div>
                                        <div class="course-info">Industry: ${course.Industry}</div>
                                        <div class="course-info">Course Type: ${course.CourseType}</div>
                                        <div class="course-info">Duration: ${course.Duration}</div>
                                        <div class="course-info">Similarity Score: ${course.Similarity_Score}%</div>
                                        <div class="course-points">Total Points: ${course.Total_Points}</div>
                                    </div>`;
                                courseResults.append(card);
                            }
                        });

                        if (courseResults.children().length === 0) {
                            courseResults.html('<p class="no-results">No courses found with a similarity score above 20%.</p>');
                        }
                    } else {
                        courseResults.html('<p class="no-results">No courses found matching your profile.</p>');
                    }
                },
                error: function(error) {
                    $('#feedback').text('Error fetching recommendations. Please try again later.');
                }
            });
        });
    });
</script>

</body>
</html>
